

<!DOCTYPE html>
<html class="writer-html5" lang="ru" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Update to pandapower 2.0 &mdash; документация Calculation of electrical networks 1.1</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/translations.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="author" title="Об этих документах" href="../about.html" />
    <link rel="index" title="Алфавитный указатель" href="../genindex.html" />
    <link rel="search" title="Поиск" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Calculation of electrical networks
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../about.html">О программе</a></li>
<li class="toctree-l1"><a class="reference internal" href="../elements.html">Описания элементов</a></li>
<li class="toctree-l1"><a class="reference internal" href="../editor.html">Функции редактора</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Calculation of electrical networks</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Update to pandapower 2.0</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/about/update.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <span class="target" id="update"></span><div class="section" id="update-to-pandapower-2-0">
<h1>Update to pandapower 2.0<a class="headerlink" href="#update-to-pandapower-2-0" title="Ссылка на этот заголовок">¶</a></h1>
<p>Some fundamental changes were made to make pandapower more easy to use and consistent with other tools with the release of pandapower 2.0.</p>
<p>Most of these changes go back to the fact that pandapower was originally developed only for power flow calculations in low and medium voltage networks, but is today also widely
used in transmission systems. The most significant changes are:</p>
<ul class="simple">
<li><p>the power unit was changed from kW to MW</p></li>
<li><p>the signing system in gen, sgen and ext_grid was changed to a generator based system</p></li>
<li><p>some transformer parameters were renamed for better readability</p></li>
<li><p>the definition of constraints and costs was made easier and more intuitive</p></li>
</ul>
<p>These changes are not backwards compatible, which is why a major release was necessary. In the following you can find a description for how to update from pandapower 1.x to 2.x.</p>
<p>Of course there are also many new features in addition to these changes, such as <span class="xref std std-ref">an Interface to PowerModels.jl</span>.</p>
<div class="section" id="how-to-update-saved-networks">
<h2>How to update saved networks<a class="headerlink" href="#how-to-update-saved-networks" title="Ссылка на этот заголовок">¶</a></h2>
<p>pandapower has a convert_format function that detects if an network that was saved to the hard drive with an older version of pandapower, and automatically corrects
the data names and values in the element tables. However, the older the network is and the more changes have been made to the data structure, the more difficult
it will be for the convert_format function to apply all necessary changes. Therefore, it is strongly advised to resave all networks when updating pandapower
(especially with a major update such as 2.0):</p>
<img alt="../_images/convert_format.png" class="align-center" src="../_images/convert_format.png" />
<p>With pandapower 2.0, we also advice to save networks in the .json format. It is much more robust to updates of libraries (for example, a .p file created with pandas &lt; 0.20 can
not be loaded with pandas 0.20 due to a change in the internal data structures. This is not an issue when saving the networks as .json files). So resave your pickle files as .json files such as</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandapower</span> <span class="k">as</span> <span class="nn">pp</span>
<span class="n">net</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">from_pickle</span><span class="p">(</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">my_file.p&quot;</span><span class="p">)</span>
<span class="n">pp</span><span class="o">.</span><span class="n">runpp</span><span class="p">(</span><span class="n">net</span><span class="p">)</span>
<span class="n">pp</span><span class="o">.</span><span class="n">to_json</span><span class="p">(</span><span class="n">net</span><span class="p">,</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">my_file_2.0.json&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="transformer-parameter-naming">
<h2>Transformer parameter naming<a class="headerlink" href="#transformer-parameter-naming" title="Ссылка на этот заголовок">¶</a></h2>
<p>Two major changes have been made to transformer parameters:</p>
<blockquote>
<div><ul class="simple">
<li><p>the tap changer variables were renamed for better readability</p></li>
<li><p>the naming for short-circuit voltage has been changed from „vsc“ to „vk“, which is consistent with international standards such as IEC 60909</p></li>
</ul>
</div></blockquote>
<p>The meaning or value of these parameters has not changed, so that the code can be updated by searching and replacing as follows:</p>
<blockquote>
<div><ul class="simple">
<li><p>tp_ ——-&gt; tap_</p></li>
<li><p>_st_ ——&gt; _step_</p></li>
<li><p>_mid —–&gt; _neutral</p></li>
<li><p>vsc ——&gt; vk</p></li>
</ul>
</div></blockquote>
<p>Here is a full list of affected parameters:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 37%" />
<col style="width: 30%" />
<col style="width: 34%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>pandapower 1.x</p></th>
<th class="head"><p>pandapower 2.x</p></th>
<th class="head"><p>elements</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>tp_side</p></td>
<td><p>tap_side</p></td>
<td><p>trafo, trafo3w</p></td>
</tr>
<tr class="row-odd"><td><p>tp_mid</p></td>
<td><p>tap_neutral</p></td>
<td><p>trafo, trafo3w</p></td>
</tr>
<tr class="row-even"><td><p>tp_min</p></td>
<td><p>tap_min</p></td>
<td><p>trafo, trafo3w</p></td>
</tr>
<tr class="row-odd"><td><p>tp_max</p></td>
<td><p>tap_max</p></td>
<td><p>trafo, trafo3w</p></td>
</tr>
<tr class="row-even"><td><p>tp_pos</p></td>
<td><p>tap_pos</p></td>
<td><p>trafo, trafo3w</p></td>
</tr>
<tr class="row-odd"><td><p>tp_st_percent</p></td>
<td><p>tap_step_percent</p></td>
<td><p>trafo, trafo3w</p></td>
</tr>
<tr class="row-even"><td><p>tp_st_degree</p></td>
<td><p>tap_step_degree</p></td>
<td><p>trafo, trafo3w</p></td>
</tr>
<tr class="row-odd"><td><p>tp_phase_shifter</p></td>
<td><p>tap_phase_shifter</p></td>
<td><p>trafo, trafo3w</p></td>
</tr>
<tr class="row-even"><td><p>vsc_percent</p></td>
<td><p>vk_percent</p></td>
<td><p>trafo</p></td>
</tr>
<tr class="row-odd"><td><p>vscr_percent</p></td>
<td><p>vkr_percent</p></td>
<td><p>trafo</p></td>
</tr>
<tr class="row-even"><td><p>vsc_hv_percent</p></td>
<td><p>vk_hv_percent</p></td>
<td><p>trafo3w</p></td>
</tr>
<tr class="row-odd"><td><p>vscr_hv_percent</p></td>
<td><p>vkr_hv_percent</p></td>
<td><p>trafo3w</p></td>
</tr>
<tr class="row-even"><td><p>vsc_mv_percent</p></td>
<td><p>vk_mv_percent</p></td>
<td><p>trafo3w</p></td>
</tr>
<tr class="row-odd"><td><p>vscr_mv_percent</p></td>
<td><p>vkr_mv_percent</p></td>
<td><p>trafo3w</p></td>
</tr>
<tr class="row-even"><td><p>vsc_lv_percent</p></td>
<td><p>vk_lv_percent</p></td>
<td><p>trafo3w</p></td>
</tr>
<tr class="row-odd"><td><p>vscr_lv_percent</p></td>
<td><p>vkr_lv_percent</p></td>
<td><p>trafo3w</p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="mva-based-units">
<h2>MVA-based Units<a class="headerlink" href="#mva-based-units" title="Ссылка на этот заголовок">¶</a></h2>
<p>The basic power unit has been changed from kVA to MVA to allow a more comfortable handling of transmission systems. This affects all three types of power units:</p>
<blockquote>
<div><ul class="simple">
<li><p>active power: kw –&gt; mw</p></li>
<li><p>reactive power: kvar –&gt; mvar</p></li>
<li><p>apparent power: kva –&gt; mva</p></li>
</ul>
</div></blockquote>
<p>All elements have to be defined with MVA-based units, and results are also given in these units.
Since the units in pandapower are always hard coded in the column names, the access to the dataframes also has to be adapted:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 46%" />
<col style="width: 54%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>pandapower 1.x</p></th>
<th class="head"><p>pandapower 2.x</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">pp.create_load(net,</span> <span class="pre">bus=3,</span> <span class="pre">p_kw=200,</span> <span class="pre">q_kvar=100,</span> <span class="pre">sn_kva=500)</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">pp.create_load(net,</span> <span class="pre">bus=3,</span> <span class="pre">p_mw=0.2,</span> <span class="pre">q_mvar=0.1,</span> <span class="pre">sn_mva=0.5)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">bus_sum_kw</span> <span class="pre">=</span> <span class="pre">net.bus.p_kw.sum()</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">bus_sum_kw</span> <span class="pre">=</span> <span class="pre">net.bus.p_mw.sum()*1e3</span></code> or <br />
<code class="code docutils literal notranslate"><span class="pre">bus_sum_mw</span> <span class="pre">=</span> <span class="pre">net.bus.p_mw.sum()</span></code></p></td>
</tr>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">net.shunt.p_kw</span> <span class="pre">*=</span> <span class="pre">2</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">net.shunt.p_mw*=2</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">p_from_kw</span> <span class="pre">=</span> <span class="pre">net.res_line.p_from_kw</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">p_from_kw</span> <span class="pre">=</span> <span class="pre">net.res_line.p_from_mw*1e3</span></code> or <br />
<code class="code docutils literal notranslate"><span class="pre">p_from_mw</span> <span class="pre">=</span> <span class="pre">net.res_line.p_from_mw</span></code></p></td>
</tr>
</tbody>
</table>
<p>The single exception is the parameter pfe_kw in net.trafo and net.trafo3w, which remains in kW. This is because the iron losses of transformers are almost always in the kW range.</p>
</div>
<div class="section" id="generation-based-signing-system">
<h2>Generation Based Signing System<a class="headerlink" href="#generation-based-signing-system" title="Ссылка на этот заголовок">¶</a></h2>
<p>In pandapower 1.x, the signing system for all elements (including the generator type elements) was from a load point of view. This has the advantage of consistency, but
on the other hand leads to confusion and non-intuitive commands when generators are modeled in a load-based system. Therefore, three elements have been changed to
a generator based signing system:</p>
<blockquote>
<div><ul class="simple">
<li><p>net.gen</p></li>
<li><p>net.sgen</p></li>
<li><p>net.ext_grid</p></li>
</ul>
</div></blockquote>
<p>All other elements remain in the load-based signing system.
So for these three elements, in addition to the unit being changed from kW to MW, the sign for active and reactive power is also reversed:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 51%" />
<col style="width: 49%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>pandapower 1.x</p></th>
<th class="head"><p>pandapower 2.x</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">pp.create_sgen(net,</span> <span class="pre">bus=3,</span> <span class="pre">p_kw=-500,</span> <span class="pre">q_kvar=100,</span> <span class="pre">sn_kva=1000)</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">pp.create_sgen(net,</span> <span class="pre">bus=3,</span> <span class="pre">p_mw=0.5,</span> <span class="pre">q_mvar=-0.1,</span> <span class="pre">sn_mva=1.)</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">gen_power_kw</span> <span class="pre">=</span> <span class="pre">-net.res_gen.p_kw.sum()</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">gen_power_kw</span> <span class="pre">=</span> <span class="pre">net.res_gen.p_mw.sum()*1e3</span></code> or <br />
<code class="code docutils literal notranslate"><span class="pre">gen_power_mw</span> <span class="pre">=</span> <span class="pre">net.res_gen.p_from_mw.sum()</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="constraints">
<h2>Constraints<a class="headerlink" href="#constraints" title="Ссылка на этот заголовок">¶</a></h2>
<p>Constraints are also changed to MVA-based units, and they are also affected by the change in the signing. Because of the change in signing, the
minimum and maximum constraints are switched in the tables gen, ext_grid and sgen:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>pandapower 1.x</p></th>
<th class="head"><p>pandapower 2.x</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="code docutils literal notranslate"><span class="pre">net.gen.min_p_kw=-2000</span></code> <br />
<code class="code docutils literal notranslate"><span class="pre">net.gen.max_p_kw=0</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">net.gen.min_p_mw=0</span></code> <br />
<code class="code docutils literal notranslate"><span class="pre">net.gen.max_p_mw=2</span></code></p></td>
</tr>
<tr class="row-odd"><td><p><code class="code docutils literal notranslate"><span class="pre">net.ext_grid.min_q_kvar=-300</span></code> <br />
<code class="code docutils literal notranslate"><span class="pre">net.ext_grid.max_q_kvar=400</span></code></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">net.ext_grid.min_q_mvar=-0.4</span></code> <br />
<code class="code docutils literal notranslate"><span class="pre">net.ext_grid.max_q_mvar=0.3</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="cost-functions">
<h2>Cost Functions<a class="headerlink" href="#cost-functions" title="Ссылка на этот заголовок">¶</a></h2>
<p>Constraints are also changed to MVA-based units, and they are also affected by the change in the signing. In addition to that, for polynomial costs,
the cost parameters can be directly specified as parameters instead of passing a list of polynomials:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>pandapower 1.x</strong></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">pp.create_polynomial_costs(net,</span> <span class="pre">3,</span> <span class="pre">&quot;gen&quot;,</span> <span class="pre">[0,</span> <span class="pre">-10,</span> <span class="pre">-100])</span></code></p></td>
</tr>
<tr class="row-even"><td><p><strong>pandapower 2.x</strong></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">pp.create_poly_cost(net,</span> <span class="pre">3,</span> <span class="pre">&quot;gen&quot;,</span> <span class="pre">c_per_mw=0.1,</span> <span class="pre">c2_per_mw2=0.01)</span></code></p></td>
</tr>
</tbody>
</table>
<p>The definition of piecewise linear costs has also changed. In pandapower 1.x, the cost polyonmial is given as list of cost points:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="n">p1</span><span class="p">,</span> <span class="n">c1</span><span class="p">),</span> <span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">c2</span><span class="p">),</span> <span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">c3</span><span class="p">)]</span>
</pre></div>
</div>
<p>The cost function is then interpolated between those points, and the costs are then defined by the slope of the curve between those points.
So for a generator with the cost function:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">50</span><span class="p">),</span> <span class="p">(</span><span class="mi">300</span><span class="p">,</span> <span class="mi">250</span><span class="p">)]</span>
</pre></div>
</div>
<p>the costs are 0.5 €/MW in the range between 0 and 100 MW and 1€/MW in the range between 100 MW and 300 MW.</p>
<p>With this definition of the cost function, the actual costs are not intuitively clear from the defined function.
In pandapower 2.0, the costs are therefore defined with a range and slope:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">,</span> <span class="n">c1</span><span class="p">),</span> <span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">,</span> <span class="n">c2</span><span class="p">)]</span>
</pre></div>
</div>
<p>The same cost function that was defined as above would therefore be defined in pandapower 2.0 as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mf">1.</span><span class="p">)]</span>
</pre></div>
</div>
<p>which allows direct definition of the costs and ranges.</p>
<p>Of course the signing changes and the MVA-unit changes also apply, so that in summary the different cost function definitions look like this:</p>
<table class="docutils align-default">
<colgroup>
<col style="width: 15%" />
<col style="width: 85%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><strong>pandapower 1.x</strong></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">pp.create_piecewise_linear_costs(net,</span> <span class="pre">3,</span> <span class="pre">&quot;gen&quot;,</span> <span class="pre">[(0,</span> <span class="pre">0),</span> <span class="pre">(-10000,</span> <span class="pre">-50),</span> <span class="pre">(-30000,</span> <span class="pre">-250)])</span></code></p></td>
</tr>
<tr class="row-even"><td><p><strong>pandapower 2.x</strong></p></td>
<td><p><code class="code docutils literal notranslate"><span class="pre">pp.create_pwl_cost(net,</span> <span class="pre">3,</span> <span class="pre">&quot;gen&quot;,</span> <span class="pre">[(0,</span> <span class="pre">10,</span> <span class="pre">0.5),</span> <span class="pre">(10,</span> <span class="pre">30,</span> <span class="pre">1.)])</span></code></p></td>
</tr>
</tbody>
</table>
</div>
<div class="section" id="measurements">
<h2>Measurements<a class="headerlink" href="#measurements" title="Ссылка на этот заголовок">¶</a></h2>
<p>There have been changes in the measurement table of pandapower grids.
<em>element</em> is set to the pandapower index of the measured element, <em>bus</em> is not a column anymore.
The new column <em>side</em> defines the side of the element at which the measurement is placed.
It can be «from» / «to» for lines, «hv» / «mv» / «lv» for trafo/trafo3w elements and is None for bus measurements.
Explicitly setting a bus index for <em>side</em> is still possible.
<em>type</em> is renamed to <em>measurement_type</em> for additional clarity.
Power measurements are set in MW or MVar now, consistent with the other pandapower tables.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, РУП ВЭ.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>